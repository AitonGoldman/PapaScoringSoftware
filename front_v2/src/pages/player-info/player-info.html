<!--
  Generated template for the PlayerInfoPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
  -->

<ion-header>
  <ion-navbar color='pss-header'>
    <custom-headers [homePageDisplayName]="getHomePageDisplayString()" [title]="eventName" [eventId]="eventId" [eventName]="eventName" [homePage]="getHomePageString()"></custom-headers>
    <ion-buttons end showWhen='mobile' *ngIf="infoOnly!=true">
      <button no-margin [navPush]="'ResultsPage'" [navParams]="buildNavParams({})" icon-only ion-button> <ion-icon name="clipboard"></ion-icon></button><br>
      <p no-margin style='font-size:8px;line-height:8px' text-center>Results<br>Home</p>
    </ion-buttons>
    
  </ion-navbar>    
</ion-header>

<ion-content no-padding no-margin>
 <ion-toolbar no-padding no-margin color="pss-sub-header" text-center>
   <b>Player {{infoOnly==true?"Info":"Results"}}</b>
 </ion-toolbar>

  <div class='desktopSlim'>  
  <ion-auto-complete *ngIf="hideAutoComplete==false" (keyup)="onKeyUp($event)"  name="myautocomplete" [(ngModel)]="selectedPlayer" #searchbar (autoFocus)="onFocus()" (ionAutoInput)="onInput($event)" (itemsShown)="onItemsShown()" (itemSelected)="onAutoCompletePlayerSelected($event)" [dataProvider]="autoCompleteProvider" [options]="{ placeholder : 'Enter Player Name/Player Number', debounce:500}"></ion-auto-complete>
  <div text-center  margin-bottom [style.height]="'25px'">
    <ion-spinner  *ngIf='loading==true' style='margin-bottom:7px'></ion-spinner>
    <ion-item no-lines text-center *ngIf='selectedPlayer!=null'>
      {{selectedPlayer.player_full_name}}
    </ion-item>

  </div>
  <div [style.color]="'red'" *ngIf="notFoundMessage!=null" padding margin text-center>
    <h2>{{notFoundMessage}}</h2>
  </div>
  <ion-list *ngIf="notFoundMessage==null && selectedPlayer!=null" no-margin>
    <ion-item no-lines text-center>
      <ion-avatar  style='zoom:3.0'>
        <!--<img [src]="selectedPlayer.img_url!=null?selectedPlayer.img_url:'/assets/imgs/pinball_small_machine_square.jpg'" style='margin-left:auto;margin-right:auto'>-->
        <img-loader [src]="selectedPlayer.img_url!=null?imgBaseUrl+selectedPlayer.img_url:imgBaseUrl+'/assets/imgs/pinball_small_machine_square.jpg'" useImg ></img-loader>
      </ion-avatar>
    </ion-item>
    <div text-center margin-top margin-bottom>
      <ion-chip tappable (click)="onReload()" *ngIf="infoOnly!=true">
      <ion-label>Refresh</ion-label>
      <ion-icon name="refresh" color="dark" item-end></ion-icon>      
    </ion-chip>
    </div>
    <ion-item-divider text-center color="light">
      Player Number
    </ion-item-divider>
    <ion-item text-center no-lines>
      {{selectedPlayer.player_id_for_event}}
    </ion-item>
    <ion-item-divider text-center color="light" *ngIf="selectedPlayer.pin!=null">
      Player Pin
    </ion-item-divider>
    <ion-item text-center no-lines *ngIf="selectedPlayer.pin!=null">
      {{selectedPlayer.pin}}
    </ion-item>    
    <ion-item-divider text-center color="light">
      Available Tickets
    </ion-item-divider>
  </ion-list>
  
  <ion-grid *ngIf="notFoundMessage==null && selectedPlayer!=null">
    <ion-row>
      <ng-container *ngFor="let ticketCount of ticketCounts;index as i; even as e">
        <ion-col col-6 text-center *ngIf="i!=ticketCounts.length-1 ||(i==ticketCounts.length-1 && e==false)">
          {{ticketCount.tournament_name}} : {{ticketCount.count}}    
        </ion-col>
        <ion-col col-12 text-center *ngIf="i==ticketCounts.length-1 && e==true">
          {{ticketCount.tournament_name}} : {{ticketCount.count}}    
        </ion-col>
        
      </ng-container>
    </ion-row>
    <ion-row *ngIf="ticketCounts==null || ticketCounts.length==0" margin-top>
      <ion-col text-center >
        No tickets available.
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-item-divider text-center color="light" *ngIf="notFoundMessage==null && selectedPlayer!=null && infoOnly==false">
      Scores
  </ion-item-divider>
  <ion-grid *ngIf="notFoundMessage==null && selectedPlayer!=null && infoOnly==false" no-padding>
    <div *ngIf="results==null || results.length==0" text-center margin-top>
      No games have been played.
    </div>
    <ng-container *ngFor='let result of results;index as i;'>
      <ion-row margin-bottom margin-top *ngIf="i!=0">
      </ion-row>
      <ion-row margin-top margin-bottom>
        <ion-col text-center>
          <a tappable [navPush]="'ResultsTournamentPage'" [navParams]="buildNavParams({tournamentId:result.tournament_id,tournamentName:result.tournament_name})"><b>{{result.tournament_name}}</b></a>
          <hr style='width:50%;height:2px'/>
          <i>{{result.rank}}{{nth(result.rank)}}</i>
        </ion-col>
      </ion-row>
    <ion-row>
      <ion-col col-12 text-center style="background-color:#FFFFCC" >
        Signifigant Machine Scores
      </ion-col>
      <ion-col col-5 text-left>
        <u>Machine</u>
      </ion-col>
      <ion-col col-2 text-center>
        <u>Rank</u>
      </ion-col>
      <ion-col col-5 text-right>
        <u>Score</u>
      </ion-col>      
    </ion-row>
    <ion-row *ngFor='let top_machine of result.top_machines;index as i'>
      <ion-col col-12 text-center *ngIf="i==tournamentSettings.getTournament(result.tournament_id).number_of_signifigant_scores" style="background-color:#FFFFCC">
        Non Signifigant Scores
      </ion-col>
      <ion-col col-5 text-left>
          <a tappable [navPush]="'ResultsMachinePage'" [navParams]="buildNavParams({tournamentMachineId:top_machine.tournament_machine_id,tournamentMachineName:top_machine.tournament_machine_name,tournamentId:result.tournament_id,tournamentName:result.tournament_name})">{{top_machine.tournament_machine_name}}</a>
      </ion-col>
      <ion-col col-2 text-center>
        {{top_machine.rank}} 
      </ion-col>      
      <ion-col col-5 text-right>
        {{top_machine.score| number}}        
      </ion-col>      
    </ion-row>
    </ng-container>
  </ion-grid>
  </div>
</ion-content>
